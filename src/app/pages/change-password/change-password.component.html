<div class="change-password-container">
  <div class="change-password-card">
    <h2>Change Password</h2>
    
    <!-- Error Alert -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      <div class="alert-content">
        <i class="fas fa-exclamation-circle alert-icon"></i>
        <span>{{ errorMessage }}</span>
      </div>
      <button class="alert-close" (click)="clearError()">&times;</button>
    </div>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
      <!-- Current Password -->
      <div class="form-group">
        <label for="currentPassword">Current Password</label>
        <div class="password-input-group">
          <input
            [type]="showCurrentPassword ? 'text' : 'password'"
            id="currentPassword"
            formControlName="currentPassword"
            class="form-control"
            [class.is-invalid]="
              changePasswordForm.get('currentPassword')?.touched &&
              changePasswordForm.get('currentPassword')?.invalid
            "
          />
          <button 
            type="button" 
            class="password-toggle" 
            (click)="togglePasswordVisibility('current')"
          >
            <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div class="invalid-feedback" *ngIf="changePasswordForm.get('currentPassword')?.touched">
          {{ getErrorMessage('currentPassword') }}
        </div>
      </div>

      <!-- New Password -->
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <div class="password-input-group">
          <input
            [type]="showNewPassword ? 'text' : 'password'"
            id="newPassword"
            formControlName="newPassword"
            class="form-control"
            [class.is-invalid]="
              changePasswordForm.get('newPassword')?.touched &&
              changePasswordForm.get('newPassword')?.invalid
            "
          />
          <button 
            type="button" 
            class="password-toggle" 
            (click)="togglePasswordVisibility('new')"
          >
            <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div class="invalid-feedback" *ngIf="changePasswordForm.get('newPassword')?.touched">
          {{ getErrorMessage('newPassword') }}
        </div>
      </div>

      <!-- Confirm New Password -->
      <div class="form-group">
        <label for="confirmPassword">Confirm New Password</label>
        <div class="password-input-group">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            class="form-control"
            [class.is-invalid]="
              changePasswordForm.get('confirmPassword')?.touched &&
              (changePasswordForm.get('confirmPassword')?.invalid ||
                changePasswordForm.errors?.['passwordMismatch'])
            "
          />
          <button 
            type="button" 
            class="password-toggle" 
            (click)="togglePasswordVisibility('confirm')"
          >
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div
          class="invalid-feedback"
          *ngIf="
            changePasswordForm.get('confirmPassword')?.touched &&
            (changePasswordForm.get('confirmPassword')?.invalid ||
              changePasswordForm.errors?.['passwordMismatch'])
          "
        >
          {{ getErrorMessage('confirmPassword') }}
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary w-100"
        [disabled]="changePasswordForm.invalid || isLoading"
      >
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
        Change Password
      </button>
    </form>
  </div>
</div> 